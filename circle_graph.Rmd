```{r}
library(tidyverse)

hd <- read.csv("data_files/historical_details.csv",
               fileEncoding="UTF-8-BOM",
               header =TRUE)
pi <- read.csv("data_files/patient_info.csv",
               fileEncoding="UTF-8-BOM",
               header =TRUE)
max_hour <- max(hd$hours_of_stay, na.rm=TRUE)
max_day <- max(hd$Day.on.Unit, na.rm=TRUE)
discharge_hours <- (pi$length_of_stay.days. * 24)
discharge_dates <- data.frame(patient_id = pi$patient_ID, discharge = discharge_hours)
#discharge_dates$discharge=as.numeric(levels(discharge_dates$discharge))[discharge_dates$discharge]
ggplot(discharge_dates, aes(x=discharge, y=reorder(patient_id, discharge))) +
  geom_point(color='red') +
geom_point(data=hd, aes(x=hours_of_stay, y=reorder(patient_ID, max_hour), color = cut(qsec, c(-Inf, 400, 500, Inf)), size=distance^(1/.7)), inherit.aes=FALSE, alpha = 0.2) +
  scale_color_manual(name = "qsec",
                     values = c("(-Inf, 400)" = "black",
                                "[400, 500]" = "blue",
                                "(500, Inf)" = "black"),
                     labels = c("< 400", "400<= qsec <= 500", "> 19")) + 
  scale_size_continuous(range = c(0.5, 10)) +
  scale_size(breaks = c(2000, 20000, 60000, 200000, 600000), range = c(0.5, 10)) +
  scale_y_discrete() +
  scale_x_continuous(breaks=seq(0,max_hour,24)) +
  ggtitle("Patient Ambulation Distance by Time") +
  xlab("Hour of Stay") + 
  ylab("Patient ID")
```